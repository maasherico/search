<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Search Supplier Data</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        input, select, button {
            padding: 10px;
            margin: 5px 0;
        }
        #suggestions {
            border: 1px solid #ddd;
            max-height: 150px;
            overflow-y: auto;
            margin-top: 5px;
            position: absolute;
            background: white;
            width: 200px;
            display: none;
        }
        #suggestions div {
            padding: 8px;
            cursor: pointer;
        }
        #suggestions div:hover {
            background: #f0f0f0;
        }
    </style>
</head>
<body>
    <h1>Search Supplier Data</h1>
    <select id="searchType">
        <option value="Supplier Code">Supplier Code</option>
        <option value="Description">Description</option>
        <option value="Default Location">Location</option>
    </select>
    <input type="text" id="searchInput" placeholder="Enter search term" oninput="showSuggestions()">
    <div id="suggestions"></div>
    <button onclick="search()">Search</button>
    <div id="result"></div>

    <script>
        // CSV URL from your Google Sheets
        const CSV_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vShJf083IYD8Wi-9jwzYX7OKheaZIAIhjS9MZyqxgLfKi5rxRBaPyBm-EgdMqF2oKKp25iZTkafgyBr/pub?output=csv';

        let csvData = [];

        // Fetch the CSV data when the page loads
        fetch(CSV_URL)
            .then(response => response.text())
            .then(text => {
                csvData = parseCSV(text);
            })
            .catch(error => {
                console.error('Error fetching CSV:', error);
                alert('Failed to load data. Please check the CSV URL.');
            });

        // Parse CSV data into an array of objects
        function parseCSV(csvText) {
            const lines = csvText.split('\n').map(line => line.trim()).filter(line => line);
            const headers = lines[0].split(',').map(header => header.trim());
            return lines.slice(1).map(line => {
                const values = line.split(',').map(value => value.trim());
                const entry = {};
                headers.forEach((header, index) => {
                    entry[header] = values[index] || '';
                });
                return entry;
            });
        }

        // Show suggestions based on input
        function showSuggestions() {
            const searchType = document.getElementById('searchType').value;
            const input = document.getElementById('searchInput').value.trim().toLowerCase();
            const suggestionsDiv = document.getElementById('suggestions');
            suggestionsDiv.innerHTML = '';
            suggestionsDiv.style.display = 'none';

            if (input.length > 0) {
                const matches = csvData.filter(row => row[searchType] && row[searchType].toLowerCase().includes(input));

                if (matches.length > 0) {
                    suggestionsDiv.style.display = 'block';
                    matches.forEach(match => {
                        const suggestionItem = document.createElement('div');
                        suggestionItem.textContent = match[searchType];
                        suggestionItem.onclick = () => {
                            document.getElementById('searchInput').value = match[searchType];
                            suggestionsDiv.style.display = 'none';
                            search(); // Optional: Auto search on suggestion click
                        };
                        suggestionsDiv.appendChild(suggestionItem);
                    });
                }
            }
        }

        // Search for the selected type in the CSV data
        function search() {
            const searchType = document.getElementById('searchType').value;
            const searchTerm = document.getElementById('searchInput').value.trim().toLowerCase();
            if (!searchTerm) {
                alert('Please enter a search term.');
                return;
            }

            const result = csvData.find(row => row[searchType] && row[searchType].toLowerCase() === searchTerm);

            const resultDiv = document.getElementById('result');
            if (result) {
                resultDiv.innerHTML = `
                    <p><strong>Item Code:</strong> ${result['Item Code']}</p>
                    <p><strong>Description:</strong> ${result['Description']}</p>
                    <p><strong>Default Location:</strong> ${result['Default Location']}</p>
                `;
            } else {
                resultDiv.innerHTML = '<p>No results found for the given search term.</p>';
            }
        }

        // Hide suggestions when clicking outside
        document.addEventListener('click', function (event) {
            if (!document.getElementById('searchInput').contains(event.target) &&
                !document.getElementById('suggestions').contains(event.target)) {
                document.getElementById('suggestions').style.display = 'none';
            }
        });
    </script>
</body>
</html>
